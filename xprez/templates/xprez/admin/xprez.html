{% load i18n %}
{% load xprez_admin %}

{# TODO: cleanup #}
<style>
    [data-hidden] {
        display: none;
    }
    [data-has-errors] {
        border: 1px solid red;
    }
    .xprez-errors {
        color: red;
    }
    [data-component="xprez-section"][data-collapsed] .xprez-section-grid {
        display: none;
    }
    [data-component="xprez-section"][data-collapsed] .xprez-section__footer {
        display: none;
    }

    [data-component="xprez-section-config"][data-mode="delete"] {
        border: 1px solid red;
    }
    [data-component="xprez-section-config"][data-mode="delete"] > * {
        display: none;
    }
    [data-component="xprez-section-config"] [data-component="xprez-section-config-delete-info"] {
        display: none;
    }
    [data-component="xprez-section-config"][data-mode="delete"] [data-component="xprez-section-config-delete-info"] {
        display: block;
    }

    .sortable-ghost {
        opacity: 0.4;
        border: 1px dashed orange;
    }

    .sortable-drag {
        border: 1px dashed blue;
        opacity: 0.8;
    }

    .xprez-section__header,
    .xprez-module__header {
        cursor: grab;
    }

    .xprez-section__header:active,
    .xprez-module__header:active {
        cursor: grabbing;
    }
</style>

<div class="xprez" data-component="xprez">
    <div class="xprez-top">
        <div class="xprez-option" data-active="true" data-text-label="true">
            <label for="view">
                <i class="xprez-icon-view"></i>
                <span>View</span>
            </label>
            <span class="xprez-option__dropdown">
                <select class="xprez-option__select" id="view" data-component="xprez-view-select">
                    <option value="sm">Default edit view</option>
                    {% for id, data in form.xprez_admin.xprez_breakpoints.items %}
                        <option value="{{ id }}">{{ data.name|safe }}</option>
                    {% endfor %}
                </select>
            </span>
        </div>

        <span class="xprez-btn xprez-btn-transparent xprez-btn--sm" data-component="xprez-all-sections-collapser">
            <i class="xprez-icon-vertical"></i>
            Collapse all
        </span>
        <span class="xprez-btn xprez-btn-transparent xprez-btn--sm {# success #}">
            <span class="xprez-btn__inner xprez-btn__success">
                {% include "xprez/admin/icons/checkmark.html" %}
                Copied
            </span>
            <span class="xprez-btn__inner xprez-btn__default">
                <i class="xprez-icon-copy"></i>
                Copy all
            </span>
        </span>
    </div>

    <div data-component="xprez-sections-container">
        {% for section in form.xprez_sections %}
            {% xprez_section_render_admin section %}
        {% endfor %}
    </div>

    {% comment %} {% include "./dev/section.html" %} {% endcomment %}

    {% with available_modules=form.xprez_get_available_modules %}
        {% if available_modules %}
            <div class="xprez-add-after">
                <div class="xprez-section__header--centered">
                    <h3>Add section</h3>
                </div>
                {% include "./includes/add_list.html" with component_name="xprez-adder-container-end" xprez_admin=form.xprez_admin add_list_container=form.instance %}
            </div>
        {% endif %}
    {% endwith %}
</div>

<script>
    window.addEventListener("DOMContentLoaded", function() {
        window.xprez = new Xprez();
    });
</script>
